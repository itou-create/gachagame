<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>わくわくガチャ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;700;900&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            display: ['"Zen Kaku Gothic New"', 'system-ui', 'sans-serif'],
          },
        },
      },
    };
  </script>
  <style>
    :root {
      color-scheme: light;
    }

    body {
      margin: 0;
      background-color: #fef9c3;
      font-family: 'Zen Kaku Gothic New', 'Hiragino Sans', 'Yu Gothic', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    #root {
      min-height: 100vh;
    }

    @keyframes wiggle {
      0%,
      100% {
        transform: rotate(0deg);
      }
      25% {
        transform: rotate(-1deg);
      }
      75% {
        transform: rotate(1deg);
      }
    }

    @keyframes bounce-slight {
      0%,
      100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-5px);
      }
    }

    @keyframes drop-capsule {
      0% {
        top: -20px;
        opacity: 0;
      }
      100% {
        top: 120%;
        opacity: 1;
      }
    }

    @keyframes bounce-in {
      0% {
        transform: scale(0) translateY(-50px);
        opacity: 0;
      }
      60% {
        transform: scale(1.1) translateY(10px);
        opacity: 1;
      }
      100% {
        transform: scale(1) translateY(0);
      }
    }

    @keyframes fade-in {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .animate-wiggle {
      animation: wiggle 0.2s ease-in-out infinite;
    }

    .animate-bounce-slight {
      animation: bounce-slight 2s ease-in-out infinite;
    }

    .animate-drop-capsule {
      animation: drop-capsule 0.6s cubic-bezier(0.5, 0, 0.8, 1) forwards;
    }

    .animate-bounce-in {
      animation: bounce-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    .animate-fade-in {
      animation: fade-in 0.3s ease-out forwards;
    }
  </style>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel" data-presets="env,react">
    const { useState, useRef } = React;

    const TASKS = [
      "まずは手洗い・うがい！ガラガラ〜！",
      "ランドセルを開けて、連絡帳をおうちの人に出そう！",
      "給食セットを洗濯カゴに入れよう！",
      "明日の時間割を今のうちにそろえよう！",
      "宿題を机の上に出して準備OK！",
      "脱いだ靴をきれいにそろえよう！",
      "着ていた服をハンガーにかけよう！",
      "コップ一杯のお水を飲んでひと休み！",
      "鉛筆を削って、筆箱の中を整理しよう！",
      "今日あった楽しかったことを1つ話そう！",
      "学校のプリントをテーブルに出そう！",
      "おやつタイム！ゆっくり食べよう！",
      "5分間、部屋の片付けをしよう！",
      "音読の宿題を先にやっちゃおう！",
      "好きな本を少しだけ読もう！",
      "お手伝いを1つ見つけてやってみよう！",
      "次の日に着る服を用意しておこう！",
      "ハンカチとティッシュを洗濯カゴへ！",
      "タブレットや充電器を定位置に戻そう！",
      "元気な声で「ただいま！」をもう一度言ってみよう！",
      "ランドセルの中身を全部出してほこりを払おう！",
      "上靴をベランダで干してリフレッシュしよう！",
      "給食袋の中身をチェックして足りない物を補充しよう！",
      "連絡袋のプリントに目を通して大事な予定を確認しよう！",
      "お道具箱の中身を整頓してピカピカにしよう！",
      "体操服を洗濯カゴへ入れてボタンも外そう！",
      "ノートの残りページを数えて新しいノートを準備しよう！",
      "明日の天気を調べて持ち物を考えよう！",
      "おこづかい帳に今日の使い道を書き足そう！",
      "家族に今日一番うれしかったことを話そう！",
      "観葉植物やお花にお水をあげて「ありがとう」を伝えよう！",
      "ペットのごはんや水のチェックをしよう！",
      "洗面所のタオルを新しいものに交換しよう！",
      "テレビやゲームの時間割を自分で決めて書き出そう！",
      "明日の目標を1つ紙に書いて壁に貼ろう！",
      "自分の机の引き出しを1段だけ片付けよう！",
      "お気に入りの文房具を並べて写真を撮ろう！",
      "靴下のペアを探してきれいに畳もう！",
      "家族に「お手伝いない？」と聞いてみよう！",
      "カレンダーを見て今週の予定を書き込もう！",
      "深呼吸を3回して軽くストレッチしよう！"
    ];

    const CAPSULE_COLORS = [
      { top: 'bg-red-500', bottom: 'bg-red-200' },
      { top: 'bg-blue-500', bottom: 'bg-blue-200' },
      { top: 'bg-green-500', bottom: 'bg-green-200' },
      { top: 'bg-yellow-400', bottom: 'bg-yellow-100' },
      { top: 'bg-purple-500', bottom: 'bg-purple-200' },
    ];

    const EmojiIcon = ({ label, children, className = '', decorative = false }) => (
      <span
        role="img"
        aria-label={decorative ? undefined : label}
        aria-hidden={decorative}
        className={className}
      >
        {children}
      </span>
    );

    function App() {
      const [gameState, setGameState] = useState('idle');
      const [currentTask, setCurrentTask] = useState('');
      const [rotation, setRotation] = useState(0);
      const [capsuleColor, setCapsuleColor] = useState(CAPSULE_COLORS[0]);
      const [shaking, setShaking] = useState(false);
      const audioCtxRef = useRef(null);

      const playSound = (frequency = 440, duration = 0.2, type = 'sine', volume = 0.15) => {
        const AudioContextClass = window.AudioContext || window.webkitAudioContext;
        if (!AudioContextClass) {
          return;
        }
        if (!audioCtxRef.current) {
          audioCtxRef.current = new AudioContextClass();
        }
        const ctx = audioCtxRef.current;
        if (ctx.state === 'suspended') {
          ctx.resume();
        }

        const oscillator = ctx.createOscillator();
        const gainNode = ctx.createGain();
        oscillator.type = type;
        oscillator.frequency.value = frequency;
        gainNode.gain.value = volume;

        oscillator.connect(gainNode);
        gainNode.connect(ctx.destination);

        oscillator.start();
        gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
        oscillator.stop(ctx.currentTime + duration);
      };

      const handleTurn = () => {
        if (gameState !== 'idle') {
          return;
        }

        setGameState('cranking');
        setShaking(true);
        playSound(420, 0.3, 'sawtooth', 0.22);
        const randomTask = TASKS[Math.floor(Math.random() * TASKS.length)];
        const randomColor = CAPSULE_COLORS[Math.floor(Math.random() * CAPSULE_COLORS.length)];
        setCurrentTask(randomTask);
        setCapsuleColor(randomColor);
        setRotation((prev) => prev + 360);

        setTimeout(() => {
          setShaking(false);
          setGameState('falling');

          setTimeout(() => {
            setGameState('ready_to_open');
          }, 600);
        }, 1000);
      };

      const openCapsule = () => {
        if (gameState !== 'ready_to_open') {
          return;
        }

        setGameState('opening');
        playSound(660, 0.2, 'triangle', 0.2);
        setTimeout(() => {
          setGameState('result');
          playSound(1040, 0.35, 'sine', 0.18);
        }, 800);
      };

      const resetGame = () => {
        setGameState('idle');
        setRotation(0);
        setCurrentTask('');
      };

      return (
        <div className="min-h-screen bg-yellow-50 flex flex-col items-center justify-center font-display select-none overflow-hidden py-8 px-4">
          <header className="mb-4 text-center z-10">
            <h1 className="text-4xl md:text-5xl font-black text-pink-500 drop-shadow-md tracking-wider flex items-center justify-center gap-2">
              <EmojiIcon label="キラキラ" decorative className="text-4xl text-yellow-400 drop-shadow">
                ★
              </EmojiIcon>
              わくわくガチャ
              <EmojiIcon label="キラキラ" decorative className="text-4xl text-yellow-400 drop-shadow">
                ★
              </EmojiIcon>
            </h1>
            <p className="text-gray-600 mt-2 font-bold">ハンドルを回して、お題にチャレンジ！</p>
          </header>

          <div className={`relative w-80 md:w-96 bg-red-500 rounded-t-[60px] rounded-b-3xl shadow-2xl p-4 flex flex-col items-center transition-transform duration-100 ${shaking ? 'animate-wiggle' : ''}`}>
            <div className="absolute -top-4 w-60 h-8 bg-red-600 rounded-full shadow-inner z-0"></div>

            <div className="relative w-full h-64 bg-blue-100 rounded-t-[50px] rounded-b-xl border-4 border-white/50 shadow-inner overflow-hidden mb-4 z-10">
              <div className="absolute top-4 left-4 w-12 h-20 bg-white/40 rounded-full transform -rotate-12 blur-sm pointer-events-none"></div>

              <div className="absolute inset-0 flex flex-wrap content-end justify-center p-4 gap-2 opacity-90">
                {[...Array(12)].map((_, i) => (
                  <div
                    key={i}
                    className={`w-12 h-12 rounded-full border-2 border-white/20 shadow-sm ${shaking ? 'animate-bounce-slight' : ''}`}
                    style={{
                      backgroundColor: ['#ef4444', '#3b82f6', '#22c55e', '#eab308', '#a855f7'][i % 5],
                      transform: `rotate(${i * 45}deg) translate(${Math.sin(i) * 10}px, ${Math.cos(i) * 5}px)`,
                    }}
                  >
                    <div className="w-full h-1/2 bg-white/30 rounded-t-full"></div>
                  </div>
                ))}
              </div>

              {gameState === 'falling' && (
                <div className="absolute top-0 left-1/2 transform -translate-x-1/2 w-16 h-16 rounded-full shadow-xl transition-all duration-500 ease-in z-20 animate-drop-capsule">
                  <div className="w-full h-full rounded-full overflow-hidden flex flex-col border-2 border-white/30 shadow-inner bg-white">
                    <div className={`h-1/2 w-full ${capsuleColor.top}`}></div>
                    <div className={`h-1/2 w-full ${capsuleColor.bottom}`}></div>
                  </div>
                </div>
              )}
            </div>

            <div className="w-full bg-white rounded-xl p-4 flex flex-col items-center justify-between relative shadow-inner border-t-8 border-red-700">
              <div className="relative mb-6 mt-2">
                <div className="w-24 h-24 bg-gray-200 rounded-full shadow-inner border-4 border-gray-300 flex items-center justify-center">
                  <button
                    onClick={handleTurn}
                    disabled={gameState !== 'idle'}
                    className={`w-20 h-6 bg-white border-2 border-gray-300 rounded-full shadow-md cursor-pointer transition-transform duration-1000 ease-in-out hover:bg-gray-50 active:scale-95 flex items-center justify-center z-20 ${gameState === 'idle' ? 'hover:shadow-lg' : 'cursor-not-allowed opacity-80'}`}
                    style={{ transform: `rotate(${rotation}deg)` }}
                    aria-label="ガチャを回す"
                  >
                    <div className="w-full h-1 bg-gray-200"></div>
                    <div className="absolute w-6 h-10 bg-white border-2 border-gray-300 rounded-md"></div>
                  </button>
                </div>
                <div className="absolute -right-6 top-8 text-red-500 animate-pulse">
                  <EmojiIcon label="くるくる" decorative className="text-3xl">
                    ⟳
                  </EmojiIcon>
                </div>
                <p className="text-xs font-bold text-gray-500 mt-2 text-center">ここをおしてね</p>
              </div>

              <div className="w-32 h-20 bg-gray-800 rounded-t-lg rounded-b-xl border-4 border-gray-600 relative overflow-hidden flex items-end justify-center shadow-inner">
                <div className="w-full h-4 bg-black/30 absolute top-0"></div>

                {(gameState === 'ready_to_open' || gameState === 'opening') && (
                  <button
                    onClick={openCapsule}
                    className="mb-1 w-14 h-14 rounded-full animate-bounce-in cursor-pointer hover:scale-110 transition-transform relative z-30 shadow-lg group"
                    aria-label="カプセルを開ける"
                  >
                    <div className="w-full h-full rounded-full overflow-hidden flex flex-col border border-white/20">
                      <div className={`h-1/2 w-full ${capsuleColor.top}`}></div>
                      <div className={`h-1/2 w-full ${capsuleColor.bottom}`}></div>
                    </div>
                    <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-white px-2 py-1 rounded shadow text-xs font-bold whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity">
                      あけてみて！
                    </div>
                  </button>
                )}
              </div>
            </div>

            <div className="absolute -bottom-4 left-8 w-6 h-6 bg-red-700 rounded-full"></div>
            <div className="absolute -bottom-4 right-8 w-6 h-6 bg-red-700 rounded-full"></div>
          </div>

          {(gameState === 'opening' || gameState === 'result') && (
            <div className="fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4 animate-fade-in backdrop-blur-sm">
              <div className="relative w-full max-w-sm">
                <div className={`transition-all duration-700 transform ${gameState === 'result' ? 'scale-110' : 'scale-100'}`}>
                  <div className={`h-32 w-64 mx-auto rounded-t-full border-4 border-white shadow-xl relative z-20 transition-transform duration-700 ease-out ${capsuleColor.top} ${gameState === 'result' ? '-translate-y-24 rotate-6 opacity-0' : 'translate-y-0'}`}></div>

                  <div className={`bg-white p-6 rounded-lg shadow-2xl text-center border-4 border-dashed border-yellow-300 transform transition-all duration-700 absolute top-10 left-4 right-4 z-10 ${gameState === 'result' ? 'scale-100 rotate-2' : 'scale-0 rotate-180'}`}>
                    <div className="flex justify-center mb-2">
                      <EmojiIcon label="にこにこ" decorative className="text-4xl">
                        😊
                      </EmojiIcon>
                    </div>
                    <h2 className="text-xl font-bold text-gray-400 mb-2">今回のお題は...</h2>
                    <div className="text-2xl md:text-3xl font-black text-gray-800 py-4 leading-relaxed min-h-[4rem]">
                      {currentTask}
                    </div>

                    <button
                      onClick={resetGame}
                      className="mt-6 w-full bg-pink-500 hover:bg-pink-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform transition active:scale-95 flex items-center justify-center gap-2"
                    >
                      <EmojiIcon label="もういちど" decorative className="text-xl">
                        ↻
                      </EmojiIcon>
                      もういちどあそぶ
                    </button>
                  </div>

                  <div className={`h-32 w-64 mx-auto rounded-b-full border-4 border-white shadow-xl relative z-20 transition-transform duration-700 ease-out ${capsuleColor.bottom} ${gameState === 'result' ? 'translate-y-48 -rotate-6 opacity-0' : 'translate-y-0'}`}></div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    const rootElement = document.getElementById('root');
    const root = ReactDOM.createRoot(rootElement);
    root.render(<App />);
  </script>
</body>
</html>
